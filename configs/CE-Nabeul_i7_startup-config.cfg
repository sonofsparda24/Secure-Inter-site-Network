!

!
upgrade fpd auto
version 12.4
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
!
hostname CE-Nabeul
!
boot-start-marker
boot-end-marker
!
!
no aaa new-model
no ip icmp rate-limit unreachable
ip cef
!
!
no ip dhcp use vrf connected
ip dhcp excluded-address 10.20.1.1 10.20.1.50
!
ip dhcp pool CLIENTS-NABEUL
   network 10.20.1.0 255.255.255.0
   default-router 10.20.1.1 
   domain-name hightech.local
   dns-server 192.168.209.2 
!
!
ip name-server 192.168.209.2
!
multilink bundle-name authenticated
!
!
!
!
!
!
!
!
!
!
!
!
!
!
archive
 log config
  hidekeys
! 
!
crypto isakmp policy 10
 encr aes 256
 authentication pre-share
 group 5
crypto isakmp key HIGHTECH123 address 203.0.113.10
!
!
crypto ipsec transform-set TSET esp-aes 256 esp-sha-hmac 
!
crypto map IPSEC-MAP 10 ipsec-isakmp 
 set peer 203.0.113.10
 set transform-set TSET 
 match address VPN-TRAFFIC
!
!
!
ip tcp synwait-time 5
!
track 1 rtr 10 reachability
!
!
!
!
interface Tunnel10
 ip address 192.168.100.2 255.255.255.252
 ip mtu 1400
 ip tcp adjust-mss 1360
 tunnel source 203.0.113.14
 tunnel destination 203.0.113.10
!
interface FastEthernet0/0
 description GW to LAN serveurs
 ip address 10.20.2.1 255.255.255.0
 ip nat inside
 ip virtual-reassembly
 duplex half
!
interface Serial1/0
 description Link to PE-Tunis
 ip address 172.16.2.2 255.255.255.252
 serial restart-delay 0
!
interface Serial1/1
 no ip address
 shutdown
 serial restart-delay 0
!
interface Serial1/2
 description link to ISP, Public address
 ip address 203.0.113.14 255.255.255.252
 ip nat outside
 ip virtual-reassembly
 serial restart-delay 0
 crypto map IPSEC-MAP
!
interface Serial1/3
 no ip address
 shutdown
 serial restart-delay 0
!
interface FastEthernet2/0
 description GW to LAN clients
 ip address 10.20.1.1 255.255.255.0
 ip nat inside
 ip virtual-reassembly
 duplex half
!
router bgp 65102
 bgp log-neighbor-changes
 neighbor 172.16.2.1 remote-as 65000
 !
 address-family ipv4
  neighbor 172.16.2.1 activate
  no auto-summary
  no synchronization
  network 10.20.1.0 mask 255.255.255.0
  network 10.20.2.0 mask 255.255.255.0
 exit-address-family
!
ip forward-protocol nd
ip route 0.0.0.0 0.0.0.0 203.0.113.13
ip route 10.10.0.0 255.255.0.0 Tunnel10 192.168.100.1 250
ip route 203.0.113.8 255.255.255.252 203.0.113.13
no ip http server
no ip http secure-server
!
!
ip nat inside source route-map NAT_RULE interface Serial1/2 overload
!
ip access-list standard NAT-LAN
 permit 10.20.1.0 0.0.0.255
 permit 10.20.2.0 0.0.0.255
!
ip access-list extended NO_NAT_INTERNAL
 remark exempt site-to-site (do not NAT GRE/ESP/ISAKMP or LAN-to-LAN)
 deny   gre host 203.0.113.14 host 203.0.113.10
 deny   udp host 203.0.113.14 host 203.0.113.10 eq isakmp
 deny   esp host 203.0.113.14 host 203.0.113.10
 deny   ip 10.20.0.0 0.0.255.255 10.10.0.0 0.0.255.255
 permit ip 10.20.0.0 0.0.255.255 any
ip access-list extended VPN-TRAFFIC
 remark match GRE and control/protocol for IPSec
 permit gre host 203.0.113.14 host 203.0.113.10
 permit udp host 203.0.113.14 host 203.0.113.10 eq isakmp
 permit esp host 203.0.113.14 host 203.0.113.10
!
ip sla 10
 icmp-echo 10.255.2.1 source-interface Serial1/0
 frequency 5
ip sla schedule 10 life forever start-time now
logging alarm informational
no cdp log mismatch duplex
!
!
!
route-map NAT_RULE permit 10
 match ip address NO_NAT_INTERNAL
!
!
!
!
control-plane
!
!
!
!
!
!
!
gatekeeper
 shutdown
!
!
line con 0
 exec-timeout 0 0
 privilege level 15
 logging synchronous
 stopbits 1
line aux 0
 exec-timeout 0 0
 privilege level 15
 logging synchronous
 stopbits 1
line vty 0 4
 login
!
!
end
